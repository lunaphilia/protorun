# 技術コンテキスト

## 技術スタック

### 言語実装の選択肢
- **実装言語候補**
  - **Rust**: メモリ安全性と高性能、強力な型システム、LLVMとの統合が容易
  - **OCaml/F#**: 関数型言語の実装に適した特性、効率的な型推論の実装、コンパイラ開発の実績
  - **Haskell**: 純粋関数型言語、強力な型システムと型クラス、パーサーコンビネータライブラリ
- **ビルドツール**: Cargo/Dune/Stackなど（実装言語に依存）
- **パーサー技術オプション**
  - **手書きの再帰下降パーサー**: 完全な制御、カスタムエラーメッセージ
  - **パーサーコンビネータ**: 宣言的な構文、モジュラー性、型安全性
  - **パーサージェネレータ**: ANTLR, Yacc, Menhir、高速な開発、形式的な文法定義

### 開発ツール
- **バージョン管理**: Git
- **CI/CD**: GitHub Actions
- **テストフレームワーク**: 単体テスト、統合テスト、プロパティベーステスト、ファジングテスト
- **文書化ツール**:
  - **Markdown**: 言語仕様書、設計文書、メモリーバンクの記述
  - **EBNF**: 形式的な文法定義
  - **図表生成**: Mermaid、PlantUML（アーキテクチャ図、型階層図）
  - **相互参照システム**: 文書間のリンクと参照管理

### バックエンドオプション
- **インタープリタ**: IR直接実行エンジン
- **LLVM**: 最適化パスの豊富さ、多くのターゲットアーキテクチャ、成熟したエコシステム
- **カスタムバイトコード + VM**: 完全な制御、言語固有の最適化
- **既存言語へのトランスパイル**: 迅速な開発、既存のエコシステムの活用

### ターゲット環境
- **インタープリタ**: 独自VM上での実行
- **コンパイラ**: LLVM IRへの変換とネイティブコード生成
- **クロスプラットフォーム**: Linux, macOS, Windowsをサポート

## 開発環境

### 必要なツール
- **コンパイラ/インタープリタ**: 実装言語のツールチェーン
- **エディタ/IDE**: VSCode, IntelliJ IDEA, Emacsなど（言語サーバープロトコル対応）
- **デバッガ**: 言語固有のデバッグツール

### 環境セットアップ
1. 実装言語のツールチェーンのインストール
2. 依存ライブラリのインストール
3. ビルドシステムの設定
4. テスト環境の構築

### 開発ワークフロー（段階的アプローチ）
#### 段階1: 言語設計と基本実装
1. 言語仕様の詳細化と形式化
   - 構文の形式的定義（EBNF）
   - 型システムの規則の定義
   - 評価規則の定義
   - 文書化プロセスの確立
     - 言語仕様書の構造設計
     - 文書間の相互参照システムの確立
     - 文書記述のルールと標準の定義
2. フロントエンド実装
   - 字句解析器の実装
   - 構文解析器の実装
   - 抽象構文木（AST）の定義
3. 型システム実装
   - 型チェッカーの実装
   - 型推論アルゴリズムの実装
   - 基本的な型エラー報告
4. インタープリタ実装
   - 評価器の実装
   - 基本的なランタイムシステム
   - プリミティブ操作の実装
5. 基本ライブラリ実装
   - 基本データ型（Int, Float, String, Bool）
   - コレクション（List, Map）
   - 基本的なI/O操作

#### 段階2: 高度な機能と最適化
1. 代数的効果システム実装
   - 効果型の実装
   - 効果推論の実装
   - 効果ハンドラの実装
   - 継続渡しスタイル（CPS）変換
2. 所有権システム実装
   - 所有権チェッカーの実装
   - 借用チェッカーの実装
   - ライフタイム解析の実装
   - メモリ安全性検証
3. 最適化実装
   - 中間表現（IR）の設計
   - 基本的な最適化パス
   - 型消去と特殊化
   - インライン化
4. 標準ライブラリ拡充
   - 高度なデータ構造
   - ファイルI/Oと例外処理
   - 並行処理プリミティブ
   - テスト用ユーティリティ

#### 段階3: ツールとエコシステム
1. コンパイラバックエンド
   - LLVM IRへの変換
   - ネイティブコード生成
   - 最適化パスの統合
   - クロスプラットフォームサポート
2. 開発ツール
   - REPLの実装
   - デバッガの実装
   - パッケージマネージャの設計と実装
   - ビルドシステムの実装
3. IDE統合
   - 言語サーバープロトコル（LSP）の実装
   - シンタックスハイライト
   - コード補完
   - リファクタリングサポート
4. ドキュメントとチュートリアル
   - 言語リファレンスマニュアル
   - チュートリアルと例
   - APIドキュメント
   - ベストプラクティスガイド

### 文書化プロセス
1. **言語仕様書の作成と更新**
   - 各機能の設計が確定した時点で仕様書を更新
   - 実装前に仕様を文書化し、設計の一貫性を確保
   - 実装中に発見された問題点を反映して仕様を調整
   - 文書記述のルールに従い、簡潔で一貫性のある記述を維持

2. **文書間の一貫性確保**
   - 相互参照システムを使用して関連する情報を適切にリンク
   - 用語集を維持し、用語の一貫した使用を確保
   - 定期的な文書レビューを実施し、矛盾や重複を排除
   - 自動化ツールを活用して文書の整合性をチェック

3. **文書の構造化**
   - 階層的な構造で情報を整理（章、節、項）
   - 各文書の責任範囲を明確に定義
   - 詳細レベルの一貫性を確保（同じレベルの見出しは同じ詳細度）
   - 文書テンプレートを使用して一貫したフォーマットを維持

4. **文書の更新サイクル**
   - 言語設計の変更が確定した時点で文書を更新
   - 実装の進捗に合わせて文書を更新
   - メモリーバンクを定期的に更新し、プロジェクトの状態を反映
   - 文書の変更履歴を維持し、設計決定の経緯を追跡

## 依存関係

### コア依存関係
- **パーサーコンビネータ/パーサージェネレータ**: 構文解析
- **グラフアルゴリズムライブラリ**: 型推論、効果推論、所有権分析
- **LLVM**: コンパイラバックエンド（ネイティブコード生成）
- **継続ライブラリ**: 代数的効果の実装
- **ライフサイクル管理ライブラリ**: ライフサイクル管理効果の実装

### 開発依存関係
- **テストフレームワーク**: 単体テスト、統合テスト
- **ベンチマークツール**: パフォーマンス測定
- **ドキュメント生成ツール**: 言語仕様書、APIドキュメント生成

### 標準ライブラリ
- **コアデータ構造**: リスト、マップ、セットなど
- **Option/Result型**: 値の存在/不在と成功/失敗の表現
- **I/O操作**: ファイル、ネットワーク、コンソール
- **並行処理**: スレッド、非同期処理
- **数値計算**: 整数、浮動小数点、ビット操作
- **ライフサイクル管理効果**: ファイル、ネットワーク接続、データベース接続などのリソース管理
- **効果ハンドラ**: 標準効果（Console、IO、State、Exception、LifecycleEffectなど）の実装

## 技術的制約

### パフォーマンス要件
- **コンパイル時間**: 大規模プロジェクトでも合理的なコンパイル時間
- **実行時パフォーマンス**: C/Rust/Goに匹敵する実行速度
- **メモリ使用量**: 効率的なメモリ使用と予測可能なリソース管理
- **効果ハンドラのオーバーヘッド**: 最小限に抑える

### 安全性要件
- **型安全性**: 強力な静的型チェック
- **メモリ安全性**: 所有権システムによるメモリエラーの防止
- **スレッド安全性**: データ競合の静的検出
- **nullの排除**: nullポインタ例外の可能性を排除
- **リソース安全性**: リソースリークの静的防止

### 互換性要件
- **FFI**: C言語とのインターフェース
- **エコシステム**: 既存のライブラリやツールとの統合
- **プラットフォーム**: 主要OSとアーキテクチャのサポート

## マイルストーン計画

### マイルストーン1: 基本インタープリタ（3ヶ月）
- 基本的な構文解析と型チェック
- 単純な式の評価
- 基本的なデータ型と演算

### マイルストーン2: 完全な言語機能（+3ヶ月）
- 代数的データ型と型クラス
- パターンマッチング
- モジュールシステム
- 基本的な標準ライブラリ

### マイルストーン3: 効果と所有権（+3ヶ月）
- 代数的効果システム
- 所有権と借用チェッカー
- 拡張された標準ライブラリ
- 最適化パス

### マイルストーン4: コンパイラとツール（+3ヶ月）
- LLVMバックエンド
- ネイティブコード生成
- 開発ツール（REPL、デバッガ）
- 言語サーバープロトコル
