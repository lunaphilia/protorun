# 3. 宣言

## 3.1 宣言の概要

Protorun言語における宣言は、プログラムの構成要素（変数、関数、型、トレイト、効果、ハンドラなど）を定義するための構文です。宣言は、名前とそれに紐づく実体（値、型、振る舞いなど）を導入します。

この章では、Protorunで利用可能な主要な宣言について説明します。

## 3.2 変数宣言

```
// 不変変数（デフォルト）
let x = 42
let y: Int = 42

// 可変変数
var counter = 0
var name: String = "John"
```

Protorun言語の変数宣言は、以下の原則に基づいて設計されています：

1. **不変性の優先**: デフォルトでは変数は不変（`let`）であり、これにより予測可能性と安全性が向上します
2. **明示的な可変性**: 可変変数は`var`キーワードで明示的に宣言し、意図を明確にします
3. **型推論**: 型注釈は省略可能であり、コンパイラが文脈から型を推論します
4. **静的型付け**: すべての変数は明確な型を持ち、型安全性が保証されます

不変変数をデフォルトにする設計決定は、関数型プログラミングの原則に基づいています。不変性により、コードの理解と推論が容易になり、並行処理における安全性も向上します。一方で、可変性が必要な場合には`var`キーワードを使用することで、その意図を明示的に示すことができます。

型推論により、冗長な型注釈を省略できますが、必要に応じて明示的に型を指定することも可能です。これにより、コードの簡潔さと明確さのバランスを取ることができます。

## 3.3 関数定義

```
// 基本的な関数定義
fn add(a: Int, b: Int): Int = {
  a + b
}

// 単一式の場合は中括弧を省略可能
fn square(x: Int): Int = x * x

// 効果付き関数
fn log(message: String): Unit & Console = {
  Console.log(message)
}

// ジェネリック関数
fn identity<T>(x: T): T = x

// 複数のパラメータリスト（カリー化）
fn add(a: Int)(b: Int): Int = a + b
```

Protorun言語の関数定義は、以下の原則に基づいて設計されています：

1. **一等の値**: 関数は一等の値であり、変数に代入したり、他の関数に渡したりできます
2. **型安全性**: 関数のパラメータと戻り値の型は静的に型チェックされます
3. **効果の明示**: 関数が持つ副作用は型シグネチャに明示的に記述されます
4. **多相性**: ジェネリックパラメータにより、型に依存しない汎用的なコードを書くことができます
5. **簡潔性**: 単一式の関数は中括弧を省略でき、コードの簡潔さを向上させます

特に重要な特徴：

- **効果注釈**: 関数が持つ副作用を`&`演算子で明示することで、関数の振る舞いが明確になり、予期しない副作用を防止します。これは、純粋関数型プログラミングの原則と実用性のバランスを取るための設計決定です。

- **ジェネリック関数**: 型パラメータを使用することで、様々な型に対して動作する汎用的な関数を定義できます。これにより、コードの再利用性が向上し、型安全性を維持しながら抽象化が可能になります。

- **カリー化**: 複数のパラメータリストをサポートすることで、部分適用や関数合成などの関数型プログラミングパターンを自然に表現できます。これにより、より表現力豊かなコードを書くことができます。
